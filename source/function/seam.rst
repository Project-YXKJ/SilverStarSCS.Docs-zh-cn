线缝段和程序
============

基本概念
--------

线缝段
    一个 *线缝段* 通常被分为三个部分：前加固、中间段、以及后加固和剪线。

    一个线缝段由首次正踩调速器开始，结束于调速器全后踏（position -2），也就是剪线作为结
    束标志。

缝制程序
    一个 *缝制程序*，是至少包含一个线缝段的线迹组合，我们可以称之 *线缝段 1* ，
    *线缝段 2* ... *线缝段 n* ，程序控制它们自动顺序执行，当最后一段 *线缝段 n* 执行后，
    程序结束，之后你可以再次启动循环。

自由缝程序
----------

自由缝程序一特殊的缝制程序，它只包含一个线缝段，此线缝段是自由缝，没有针数限制。

定针缝程序
----------

定针缝是允许用户自由编程的缝纫程序，最多可以编制 25 段线缝段，每段最多 99 针。

缝纫程序的功能分为两个区域：作用于缝纫程序的全局功能以及作用于线缝段的局部功能。

**全局功能**

- 软启动

*局部功能**

- 线缝段针数
- 前后加固
- 电子夹线器
- 剪线
- 线缝段中途停止时机针位置
- 线缝段中途停止后自动抬压脚
- 线缝段结束后自动抬压脚

线缝段针数为 0 的线缝段被视为一个定针缝程序的结束标识，如果下一段针数为 0 则程序将重新返
回第一段。

任意线缝段结束后，全后踏调速器（position -2）都将结束整个程序，如果此时没有执行过剪线则
执行剪线 并返回第一段，已经执行过剪线则直接返回第一段。

折返缝程序
----------

折返缝是一种特殊的缝纫程序，它只有一段线缝段，而且不能设置前后加固，往前轻触调速器，即可
以自动进行来回的连续动作，最后剪线。

来回次数由 E 设定，范围为 1 ~ 15 次，第一段针数为 A，第二段针数 B，第三段针数为 C，其余
段的针数都为 D，每段针数可设定的范围都为 1 ~ 15 针。

结束后调速器要回到初始位置才能进行下次缝制。

补针（针杆位置切换）
--------------------

如果 :option:`A03` 设置为 0：

当按动补针按键，系统会计算当前位置与 :option:`D15` 和 :option:`D16` 的距离并进行比较，那个距离近， 那么针杆就移动至哪个位置。

比如：当前针杆位置为 40°， :option:`D15` 的值为70°， :option:`D16` 的值为200°，显然 40° 距离 70° 更
近一点，那么按动补针按键运动轨迹为 ``位置40° => 70° => 200° => 70° => 200° ...`` 。

如果 :option:`A03` 设置为 1：

当按动补针按键，此时分两种情况：如果设置为停上针位，则针杆从当前位置移动至 :option:`D01` 位置； 如果设置为停下针位，则针杆从当前位置移动至
:option:`D02` 位置。

比如：当前针杆位置为 40°, :option:`D01` 的值为 70°，\ :option:`D02` 的值为 200°， 如果 :option:`A01` 为
0，则每次按动补针按键运动轨迹为 ``位置40° => 200° => 200° => 200° ...`` ； 如果 :option:`A01` 为
1，每次按动补针按键运动轨迹为 ``位置40° => 70° => 70° => 70° ...`` 。

手动倒缝按键的工作角度区间
--------------------------

对于某些机型，如果在特定位置突然反向缝制，那么机针容易断掉，参数 :option:`D11` 和 :option:`D12` 可以避免这种情况。

如果机针位置大于 :option:`D11` 并且小于 :option:`D12` ，这个区间内手动倒缝按键不会被响应。

快速参考
--------

下表总结了线迹功能所使用到的参数：

============================== ====== =============
参数                           权限   参见
============================== ====== =============
自由缝速度                     技术员 :option:`S01`
折返缝速度                     操作员 :option:`S05`
定针缝速度                     操作员 :option:`S06`
停针位                         操作员 :option:`A01`
定针缝中间段自动缝制           操作员 :option:`A02`
补针停车模式                   操作员 :option:`A03`
屏蔽 :term:`机头热键`          开发者 :option:`A07`
定针缝前加固结束后自动缝制使能 操作员 :option:`A16`
定针缝中间段结束后自动后加固   操作员 :option:`A17`
补针模式                       操作员 :option:`A30`
手动倒缝模式                   操作员 :option:`A31`
上针位角度                     技术员 :option:`D01`
下针位角度                     技术员 :option:`D02`
手动倒缝按键的工作角度区间下限 操作员 :option:`D11`
手动倒缝按键的工作角度区间上限 操作员 :option:`D12`
补针上角度                     操作员 :option:`D15`
补针下角度                     操作员 :option:`D16`
缝型标志                       操作员 :option:`O18`
补针时机                       操作员 :option:`O69`
============================== ====== =============

参数列表
--------

.. option:: S01

    -Max  4500
    -Min  50
    -Unit  spm
    -Description  自由缝最高速度，调速器踩至最深时的最大速度

.. option:: S05

    -Max  4500
    -Min  50
    -Unit  spm
    -Description  折返缝最高速度

.. option:: S06

    -Max  4500
    -Min  50
    -Unit  spm
    -Description  定针缝中间段最高速度

.. option:: A01

    -Max  1
    -Min  0
    -Unit  --
    -Description
      | 当缝制途中停车时机针的位置：
      | 0 = 下针位，机针在缝料之下；
      | 1 = 上针位，机针在缝料之上

.. option:: A02

    -Max  1
    -Min  0
    -Unit  --
    -Description
      | 定针缝中间段自动缝制：
      | 0 = 定针缝中间段速度受调速器控制；
      | 1 = 中间段自动缝制

.. option:: A03

    -Max  1
    -Min  0
    -Unit  --
    -Description
      | 0 = 补半针，针杆上下切换；
      | 1 = 补整针

.. option:: A07

    -Max  1
    -Min  0
    -Unit  --
    -Description
      | 是否屏蔽 :term:`机头热键`，缝料过厚时，用于防止误触，参数值的个位表示屏蔽状态:
      | 0 = 不屏蔽；
      | 1 = 屏蔽

.. option:: A16

    -Max  1
    -Min  0
    -Unit  --
    -Description
      | 定针缝程序中，前加固结束后是否自动开始中间段的缝制：
      | 0 = 前加固结束后停车，直到调速器再次前踩时才继续缝纫；
      | 1 = 自动缝制中间段

.. option:: A17

    -Max  1
    -Min  0
    -Unit  --
    -Description
      | 定针缝程序中，当中间段缝制完成后是否自动执行后加固及剪线：
      | 0 = 停车，再次踩踏调速器才执行终止回缝及剪线动作；
      | 1 = 自动执行

.. option:: A30

    -Max  1
    -Min  0
    -Unit  --
    -Description
      | 补针模式：
      | 0 = 每次按下按键，补针运行一次；
      | 1 = 补针会持续运行直至松开按键

.. option:: A31

    -Max  1
    -Min  0
    -Unit  --
    -Description
      | 手动倒缝模式：
      | 0 = 正常模式；
      | 1 = 停车拉倒缝

.. option:: D01

    -Max  359
    -Min  0
    -Unit  1°
    -Description  剪线后的针杆位置，机针在缝料之上

.. option:: D02

    -Max  359
    -Min  0
    -Unit  1°
    -Description  一般中途停车时针杆位置，机针在缝料之下

.. option:: D11

    -Max  359
    -Min  0
    -Unit  1°
    -Description  如果针杆位置小于此角度，手动倒缝按键不会响应

.. option:: D12

    -Max  359
    -Min  0
    -Unit  1°
    -Description  如果针杆位置大于此角度，手动倒缝按键不会响应

.. option:: D15

    -Max  359
    -Min  0
    -Unit  1°
    -Description  补针模式下的上针位角度

.. option:: D16

    -Max  359
    -Min  0
    -Unit  1°
    -Description  补针模式下的下针位角度

.. option:: O18

    -Max  3
    -Min  1
    -Unit  --
    -Description  缝型标志，只读

.. option:: O69

    -Max  1
    -Min  0
    -Unit  --
    -Description
      | 决定何时可以进行补针操作：
      | 0 = 剪线后禁止补针；
      | 1 = 停车后就可以补针
